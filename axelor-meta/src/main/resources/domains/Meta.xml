<?xml version="1.0" encoding="UTF-8"?>
<domain-models xmlns="http://apps.axelor.com/xml/ns/domain-models"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://apps.axelor.com/xml/ns/domain-models http://apps.axelor.com/xml/ns/domain-models/domain-models_0.9.xsd">

  <module name="meta" package="com.axelor.meta.db" />
  
  <entity name="MetaModule" table="META_MODULE" cachable="true">
    <string name="name" required="true" unique="true"/>
    <string name="title" required="true" />
    <string name="description"/>
    <string name="moduleVersion" required="true" title="Version"/>
    <boolean name="removable" />
    <boolean name="installed" />
    <one-to-many name="dependencies" ref="MetaModuleDependency" mappedBy="module"/>
  </entity>
  
  <entity name="MetaModuleDependency" table="META_MODULE_DEPENDENCY" cachable="true">
    <string name="name" required="true"/>
    <many-to-one name="module" ref="MetaModule" required="true"/>
  </entity>
  
  <entity name="MetaView" table="META_VIEW" sequential="true" cachable="true">
  	<string name="name" required="true"/>
	<string name="title" required="true" namecolumn="true"/>
  	<string name="type" required="true"/>
    <integer name="priority" required="true" default="20"/>
  	<string name="model"/>
    <string name="module"/>
  	<string name="xml" required="true" large="true"/>
  	<many-to-many name="groups" ref="com.axelor.auth.db.Group"/>
    
    <finder-method name="findByName" using="name" orderBy="priority"/>
    <finder-method name="findByType" using="name,type,model"
      filter="(self.name = :name) OR (self.model = :model AND self.type = :type)" orderBy="priority"/>
    <finder-method name="findByGroup" using="name,type,model,long:groupId"
      filter="((self.name = :name) OR (self.model = :model AND self.type = :type)) AND self.groups[].id = :groupId" orderBy="priority" />
  </entity>
  
  <entity name="MetaMenu" table="META_MENU" sequential="true" cachable="true">
  	<integer name="priority"/>
  	<string name="name" unique="true" required="true"/>
  	<string name="title" required="true" namecolumn="true"/>
  	<string name="icon"/>
  	<many-to-one name="parent" ref="MetaMenu"/>
  	<many-to-one name="action" ref="MetaAction"/>
  	<many-to-many name="groups" ref="com.axelor.auth.db.Group"/>
  </entity>
  
  <entity name="MetaActionMenu" table="META_ACTION_MENU" cachable="true">
  	<string name="name" unique="true" required="true"/>
  	<string name="title" required="true" namecolumn="true"/>
    <string name="category" help="Category name to group action menus."/>
  	<many-to-one name="parent" ref="MetaActionMenu"/>
  	<many-to-one name="action" ref="MetaAction"/>
  </entity>
   
  <entity name="MetaAction" table="META_ACTION" sequential="true" cachable="true">
  	<string name="name" unique="true" required="true"/>
    <string name="type" required="true"/>
    <string name="model" />
  	<string name="xml" required="true" large="true"/>
  </entity>
  
  <entity name="MetaSelect" table="META_SELECT" cachable="true">
    <string name="name" required="true" unique="true"/>
    <one-to-many name="items" ref="MetaSelectItem" mappedBy="select"/>
  </entity>

  <entity name="MetaSelectItem" table="META_SELECT_ITEM" cachable="true">
    <string name="value" required="true"/>
    <string name="title" required="true" namecolumn="true"/>
    <many-to-one name="select" ref="MetaSelect" column="select_id" required="true"/>
    <unique-constraint columns="select_id,value"/>
  </entity>
  
  <entity name="MetaModel" table="META_MODEL" sequential="true" cachable="true">
    <string name="name" title="Name" required="true"/>
    <string name="packageName" title="Package" required="true"/>
    <string name="tableName" title="Table" />
    <one-to-many name="metaFields" ref="MetaField" mappedBy="metaModel" title="Fields" />
    <string name="fullName" title="Fullname" />
  </entity>

  <entity name="MetaField" table="META_FIELD" sequential="true" cachable="true">
    <many-to-one name="metaModel" ref="MetaModel" />
    <string name="name" title="Name" required="true"/>
    <string name="packageName" title="Package" />
    <string name="typeName" title="Type"  required="true"/>
    <string name="label" title="Label" />
    <string name="relationship" title="Relationship" selection="relationship.field.selection"/>
    <string name="mappedBy" title="Mapped by" />
    <string name="description" title="Description" large="true" />
  </entity>
  
  <entity name="MetaTranslation" table="META_TRANSLATION" cachable="true">
  	<string name="key" required="true"/>
  	<string name="language" required="true"/>
  	<string name="translation"/>
  	<string name="domain"/>
  	<unique-constraint columns="key,language,domain"/>
  </entity>
  
  <entity name="MetaFile" table="META_FILE">
  	<binary name="content" title="File"/>
  	<string name="fileName" required="true" namecolumn="true"/>
  	<long name="size" title="Size in bytes" readonly="true"/>
  	<string name="mine" title="File type"/>
  	<string name="description" multiline="true"/>
  	<string name="sizeText" title="Size" readonly="true">
      <![CDATA[
      	if(size >= 1024)
      		return (size / 1024) + " KB";
      	else if(size > 1048576)
      		return (size / 1048576) + " MB";
      	else if(size > 1073741824)
      		return (size / 1073741824) + " GB";
      	return size + " Bytes";
      ]]>
  	</string>
  </entity>
  
  <entity name="MetaAttachment" table="META_ATTACHMENT">
  	<string name="objectName" required="true"/>
  	<long name="objectId" required="true"/>
  	<many-to-one name="metaFile" ref="MetaFile" title="File" required="true" column="meta_file"/>
  	<unique-constraint columns="objectName,objectId,meta_file"/>
  </entity>

  <entity name="MetaChartSeries" table="META_CHART_SERIES">
    <string name="key" required="true"/>
    <string name="groupBy" />
    <string name="title" />
    <string name="type" />
    <string name="side" />
    <string name="aggregate"/>
  </entity>

  <entity name="MetaChart" table="META_CHART">
    <string name="name" required="true" unique="true"/>
    <string name="title" />
    <boolean name="stacked" />
    <string name="query" large="true" multiline="true" required="true"/>
    <string name="queryType"/>
    <string name="categoryKey" required="true" />
    <string name="categoryType" />
    <string name="categoryTitle" />
    <one-to-many name="chartSeries" ref="MetaChartSeries" />
  </entity>

</domain-models>
